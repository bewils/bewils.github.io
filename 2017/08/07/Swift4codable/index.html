<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Swift4 JSON è§£æ | Yuki | Otaku</title>

  
  <meta name="author" content="Bewils">
  

  
  <meta name="description" content="Swift çš„ JSON è§£æä¸€ç›´æ˜¯ä¸€ä»¶å¾ˆéº»çƒ¦çš„äº‹, åœ¨ Swift3 ä¸­è¯·æ±‚ä¸€ä¸ªæ•°æ®åå¯èƒ½è¦è¿›è¡Œå¦‚ä¸‹æ“ä½œ(æ¯”å¦‚æœåŠ¡å™¨è¿”å›ä¸€ä¸ªæ•°ç»„):
if let jsonObject = try? JSONSerialization.jsonObject(with: data!, options: .allowFragments) {
  if let objectList = jsonObject as? [Any] {
    for object in objectList {
      if let object = object as? [String: Any] {
        // use object
      }
    }
  }
}">
  

  
  
  <meta name="keywords" content="Swift">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="Swift4 JSON è§£æ"/>

  <meta property="og:site_name" content="Yuki"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Yuki" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/code.css" media="screen" type="text/css">

  <style media="screen">
    body .blog .content {
      max-width: 1000px;
    }
    pre {
      word-break: break-all;
      word-wrap: break-word;
      padding: 20px;
      border-radius: 5px;
    }
    pre code {
      white-space: pre-wrap !important;
    }
  </style>

  <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
  <script type="text/javascript">
  $(window).load(function(){
    $('pre').addClass('prettyprint').attr('style', 'overflow:hidden;');
    prettyPrint();
  })
  </script>

</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">Yuki</a>
    </h1>
    <p class="site-description">Otaku</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">ä¸»é¡µ</a></li>
      
        <li><a href="/archives">å½’æ¡£</a></li>
      
        <li><a href="/tags">æ ‡ç­¾</a></li>
      
        <li><a href="/about">å…³äº</a></li>
      
        <li><a href="/atom.xml">è®¢é˜…</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>Swift4 JSON è§£æ</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2017/08/07/Swift4codable/" rel="bookmark">
        <time class="entry-date published" datetime="2017-08-07T14:05:52.000Z">
          2017-08-07
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>Swift çš„ JSON è§£æä¸€ç›´æ˜¯ä¸€ä»¶å¾ˆéº»çƒ¦çš„äº‹, åœ¨ Swift3 ä¸­è¯·æ±‚ä¸€ä¸ªæ•°æ®åå¯èƒ½è¦è¿›è¡Œå¦‚ä¸‹æ“ä½œ(æ¯”å¦‚æœåŠ¡å™¨è¿”å›ä¸€ä¸ªæ•°ç»„):</p>
<pre><code class="swift">if let jsonObject = try? JSONSerialization.jsonObject(with: data!, options: .allowFragments) {
  if let objectList = jsonObject as? [Any] {
    for object in objectList {
      if let object = object as? [String: Any] {
        // use object
      }
    }
  }
}
</code></pre>
<a id="more"></a>
<p>ç»è¿‡åƒè¾›ä¸‡è‹¦ç»ˆäºæ‹¿åˆ°äº†è¿™ä¸ª object , ç„¶è€Œå™©æ¢¦æ‰åˆšåˆšå¼€å§‹</p>
<p>è½¬æˆ <code>[String: Any]</code> çš„ object åŸºæœ¬ä¸Šæ²¡æ³•ç”¨, å¾ˆå¤šæ—¶å€™æˆ‘ä»¬è¿˜éœ€è¦å»æ‹¿æ¯ä¸ª key å’Œ value å†èµ‹ç»™æˆ‘ä»¬è‡ªå·±å®šä¹‰å¥½çš„ struct / class (åˆæ˜¯ä¸€é•¿ä¸²çš„ <code>if let as</code>)</p>
<p>å½“ç„¶, ç›®å‰è§£å†³è¿™ä¸ªé—®é¢˜è¿˜æ˜¯æœ‰ä¸€äº›åŠæ³•çš„, æ¯”å¦‚å¯ä»¥å»å°è¯•ä½¿ç”¨ <a href="https://github.com/SwiftyJSON/SwiftyJSON" target="_blank" rel="external">SwiftyJSON</a> ç›´æ¥å½“åŸç”Ÿçš„ Array / Dictionary ç”¨, æˆ–è€…æ›´é«˜çº§çš„ <a href="https://github.com/thoughtbot/Argo" target="_blank" rel="external">Argo</a>, ç›´æ¥å°† JSON data æ˜ å°„åˆ°è‡ªå·±å®šä¹‰çš„ struct</p>
<p>åœ¨ Swift4 ä¸­, Swift Standard Library å¸¦æ¥çš„æ–°çš„ç±»å’Œåè®®æ”¯æŒåŸç”Ÿçš„ JSON è§£æ. ç”šè‡³ä¸åªæ˜¯ JSON, åªè¦æ˜¯ encoding / decoding çš„è½¬åŒ–éƒ½å¯ä»¥æ”¯æŒ(æ¯”å¦‚ plist)</p>
<h2 id="å…³äº-Swift4-Codable"><a href="#å…³äº-Swift4-Codable" class="headerlink" title="å…³äº Swift4 Codable"></a>å…³äº Swift4 Codable</h2><p>åœ¨ Swfit4 ä¸­æ–°æ·»åŠ äº†ä¸€ä¸ªå¤åˆåè®®  <code>typealias Codable = Decodable &amp; Encodable</code>, æƒ³è¿›è¡Œ encoding / decoding åªè¦å®ç°è¿™ä¸ªåè®®å³å¯. è€Œä¸”æ ¹æ®éœ€è¦, å¦‚æœåªæ˜¯ä»æœåŠ¡å™¨å–æ•°æ®æˆ–åªæ˜¯å‘æœåŠ¡å™¨å‘æ•°æ®å®Œå…¨å¯ä»¥åªå®ç°å…¶ä¸­ä¸€ä¸ª, æ¥ä¸‹æ¥å…ˆæ¥è¯•éªŒä¸‹ Decodable åè®®. å…ˆæ‰¾ä¸€ä¸ª API, å°±éšä¾¿æ‰¾äº†ä¸€ä¸ªé¡¹ç›®ç›´æ¥ç”¨ github çš„ API <a href="https://api.github.com/repos/bewils/IWantTheGreenOne" target="_blank" rel="external">https://api.github.com/repos/bewils/IWantTheGreenOne</a>. é¦–å…ˆå¯ä»¥çœ‹çœ‹è¿”å›çš„æ•°æ®ç»“æ„: å› ä¸ºåªå–äº†ä¸€ä¸ª repository æ‰€ä»¥å¯ä»¥çœ‹åˆ°è¿”å›çš„ç»“æ„ä¹Ÿå¾ˆç®€å•, æŒ‰ç…§è¿™ä¸ªç»“æ„å†™å‡ºå¦‚ä¸‹ struct</p>
<pre><code class="swift">struct Repo: Decodable {
  var `private`: Bool
  var html_url: String
  var description: String?
}
</code></pre>
<p>è¿™é‡Œåªå–äº†å…¶ä¸­çš„ä¸‰ä¸ªå±æ€§, å³åªè§£æè¿”å›çš„ data çš„è¿™ä¸‰ä¸ªå­—æ®µ, ç„¶åå°è¯•å‘é€è¯·æ±‚å¹¶è§£æè¿”å›çš„æ•°æ®</p>
<pre><code class="swift">if let url = URL(string: &quot;https://api.github.com/repos/bewils/IWantTheGreenOne&quot;) {
  let session = URLSession(configuration: .default)
  session.dataTask(with: url) { (data, _, err) in
    guard err == nil else { return }

    guard let data = data else { return }
    if let repo = try? JSONDecoder().decode(Repo.self, from: data) {
      print(repo)
    } else {
      print(&quot;JSON parse failed&quot;)
    }
  }.resume()
}
</code></pre>
<p>å¥‡è¿¹å‡ºç°äº†, å¾ˆå¿«æ§åˆ¶å°é‡Œå°±è¾“å‡ºäº† <code>Repo(private: false, html_url: &quot;https://github.com/bewils/IWantTheGreenOne&quot;, description: Optional(&quot;SpriteKit Game&quot;))</code> è¿™æ ·çš„æ–‡å­—. æˆ‘ä»¬å‡ ä¹æ²¡åšä»€ä¹ˆäº‹, ä¸€å¦‚æ—¢å¾€çš„ç½‘ç»œè¯·æ±‚, åœ¨å›è°ƒå‡½æ•°ä¸­åˆ©ç”¨åŒæ ·æ˜¯ Swift4 ä¸­æ–°åŠ å…¥çš„ JSONDecoder ç±»æ¥æŒ‰ç…§ Repo çš„æ¨¡å‹è§£æ data, ç„¶åå°±æˆåŠŸçš„è¾“å‡ºäº†è§£æç»“æœ</p>
<p>Codable ä¾¿åˆ©çš„ä¸€ç‚¹è¿˜åœ¨äº Swift ä¸­ç»™å‡ºäº†è¿™ä¸ªåè®®çš„é»˜è®¤å®ç°, å°±åƒ Repo ç›´æ¥éµä» Decodable æ²¡æœ‰å†™è§£æçš„ä»»ä½•æ–¹æ³•å°±èƒ½é€šè¿‡ JSONDecoder è§£æå‡ºæ¥</p>
<p>åŒæ—¶åœ¨å£°æ˜ Repo æ—¶æˆ‘ä»¬å°† description å£°æ˜æˆäº† String? çš„ç±»å‹, è¿™æ ·å¦‚æœè¿”å›çš„æ•°æ®é‡Œæ²¡æœ‰è¿™ä¸ªå­—æ®µåªä¼šè§£æå‡º nil è€Œä¸ä¼šæŠ¥é”™</p>
<h2 id="å…³äºå­—æ®µå"><a href="#å…³äºå­—æ®µå" class="headerlink" title="å…³äºå­—æ®µå"></a>å…³äºå­—æ®µå</h2><p>ç¬¬ä¸€ä¸ªå­—æ®µ <code>private</code> æ˜¯ Swift çš„å…³é”®å­—, å½“åšå˜é‡åçš„æ—¶å€™åªèƒ½ç”¨ `` åŒ…èµ·æ¥, é‚£è¦ä¸æ¢ä¸ªåå­—æ”¹æˆ <code>jurisdiction</code>. è¿è¡Œ, å¥½çš„, æŠ¥é”™: <strong>æ²¡æœ‰ jurisdicition è¿™ä¸ªå­—æ®µ</strong></p>
<p>è¿™åªæ˜¯ä¸€ç§æƒ…å†µ, è¿˜æœ‰æ¯”å¦‚è¿”å›çš„ JSON çš„ key æ˜¯ç”¨ _ åˆ†å‰²çš„å‘½å, è€Œ Swift çš„ä»£ç é£æ ¼ä¸€èˆ¬æ˜¯é©¼å³°å‘½å, è¿™æ—¶å°±ä¼šæœ‰å­—æ®µåä¸å¯¹åº”çš„é—®é¢˜, ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, å¯ä»¥åœ¨ Repo çš„å†…éƒ¨å£°æ˜ä¸€ä¸ªéµä» CodingKey çš„å« CodingKeys æšä¸¾å€¼</p>
<pre><code class="swift">struct Repo: Decodable {
  var jurisdiction: Bool
  var htmlUrl: String
  var description: String?

  enum CodingKeys: String, CodingKey {
    case jurisdiction = &quot;private&quot;
    case htmlUrl = &quot;html_url&quot;
    case description
  }
}
</code></pre>
<p>é‡æ–°è¿è¡Œ, åˆä¸€æ¬¡æˆåŠŸåœ°è§£æå‡ºäº† Repo: <code>Repo(jurisdiction: false, htmlUrl: &quot;https://github.com/bewils/IWantTheGreenOne&quot;, description: Optional(&quot;SpriteKit Game&quot;))</code>. </p>
<p>é€šè¿‡ä½¿ç”¨ CodingKey çš„æ–¹å¼é‡æ–°å®šä¹‰ JSON key å’Œå±æ€§åçš„å¯¹åº”å…³ç³»æ˜¯å¾ˆå¥½ç”¨çš„, ä½†è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå°é—®é¢˜, å°±æ˜¯å¦‚æœä½¿ç”¨ CodingKey å°±å¿…é¡»å§æ‰€æœ‰çš„å±æ€§å’Œ key éƒ½å†™è¿›å», æ¯”å¦‚ Repo ä¸­è™½ç„¶ description ä¸éœ€è¦è½¬åŒ–è¿˜æ˜¯è¦å†™è¿›å», å¦åˆ™è¿™æ¬¡ä¼šæ‰¾ä¸åˆ° description å¯¹åº”çš„ key (å¦‚æœæœ‰ 50 ä¸ªå±æ€§çš„å¯¹è±¡ä¸ºäº†ä¸€ä¸ªå±æ€§è€Œä½¿ç”¨ CodingKeys ä¹Ÿæ˜¯å¾ˆæƒ¨çš„â€¦)</p>
<h2 id="å…³äºåµŒå¥—ç»“æ„"><a href="#å…³äºåµŒå¥—ç»“æ„" class="headerlink" title="å…³äºåµŒå¥—ç»“æ„"></a>å…³äºåµŒå¥—ç»“æ„</h2><p>å¯ä»¥çœ‹åˆ°ä» API è¿”å›çš„æ•°æ®è™½ç„¶æ˜¯åŸºæœ¬çš„ Dictionary ç»“æ„, ä½†é‡Œé¢è¿˜æ˜¯æœ‰ä¸€ä¸ª <code>owner</code> çš„å­—æ®µå±äºåµŒå¥—çš„ç»“æ„, Swift4 ä¸­è§£æåµŒå¥—ç»“æ„çš„æ–¹æ³•éå¸¸ç®€å•: ä¹Ÿç›´æ¥åµŒå¥—ä¸€ä¸ªå°±å¯ä»¥äº†</p>
<pre><code class="swift">struct Owner: Decodable {
  var login: String
  var id: Int
  var avatar_url: String
}

struct Repo: Decodable {
  var jurisdiction: Bool
  var htmlUrl: String
  var description: String?
  var owner: Owner

  enum CodingKeys: String, CodingKey {
    case jurisdiction = &quot;private&quot;
    case htmlUrl = &quot;html_url&quot;
    case description
    case owner
  }
}
</code></pre>
<p>æ–°æ·»åŠ äº†ä¸€ä¸ª Owner çš„ struct, ç„¶ååŠ åˆ° Repo ä¸­å¹¶ä¸”æ·»åŠ ä¸€ä¸ª CodingKey</p>
<p>è¿è¡Œ, è¾“å‡º: <code>Repo(jurisdiction: false, htmlUrl: &quot;https://github.com/bewils/IWantTheGreenOne&quot;, description: Optional(&quot;SpriteKit Game&quot;), owner: __lldb_expr_36.Owner(login: &quot;bewils&quot;, id: 16081099, avatar_url: &quot;https://avatars3.githubusercontent.com/u/16081099?v=4&quot;))</code></p>
<p>(ç®€ç›´å®Œç¾, æ­¤å¤„åº”æœ‰æŒå£° ğŸ‘</p>
<h2 id="å…³äºæ•°ç»„"><a href="#å…³äºæ•°ç»„" class="headerlink" title="å…³äºæ•°ç»„"></a>å…³äºæ•°ç»„</h2><p>é€šè¿‡ä¸Šé¢çš„è¿‡ç¨‹å·²ç»å¯ä»¥å°† Repo æˆåŠŸè§£æå‡ºæ¥äº†, æ— è®ºå¤šå¤æ‚çš„ JSON, åªè¦æ˜¯ key-value, æ— è®ºåµŒå¥—å¤šæ·±éƒ½æ˜¯ä¸€æ ·çš„å†™æ³•</p>
<p>ç„¶è€Œå¦‚æœè¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„å‘¢? <a href="https://api.github.com/users/bewils/repos" target="_blank" rel="external">https://api.github.com/users/bewils/repos</a></p>
<p>å…³äºæ•°ç»„çš„è§£æå°†ä¼šåˆ†ä¸ºä¸¤éƒ¨åˆ†: äºŒé€¼ç¨‹åºå‘˜å’Œæ–‡è‰ºç¨‹åºå‘˜</p>
<h3 id="äºŒé€¼ç¨‹åºå‘˜"><a href="#äºŒé€¼ç¨‹åºå‘˜" class="headerlink" title="äºŒé€¼ç¨‹åºå‘˜"></a>äºŒé€¼ç¨‹åºå‘˜</h3><p>å†å£°æ˜ä¸€ä¸ª stuct</p>
<pre><code class="swift">struct UserRepos {
  var repoList: [Repo]
}
</code></pre>
<p>å› ä¸ºè¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„, æ²¡æœ‰ key æ‰€ä»¥é€šè¿‡é»˜è®¤æ–¹æ³•è‚¯å®šè½¬æ¢ä¸æ¥, è‡ªå®šä¹‰å»å®ç° Decodable</p>
<pre><code class="swift">extension UserRepos: Decodable {
  init(from decoder: Decoder) throws {
    repoList = []

    var values = try decoder.unkeyedContainer()
    while !values.isAtEnd {
      let repo = try values.decode(Repo.self)
      repoList.append(repo)
    }
  }
}
</code></pre>
<p>è‡ªå®šä¹‰å®ç°çš„è¿‡ç¨‹ä¸­é¦–å…ˆé€šè¿‡ decoder å–å‡º unkeyedContainer å³åˆæ­¥è§£æä¸ºæ•°ç»„å‹çš„ç»“æ„, å¦‚æœè¿™æ—¶è¾“å‡ºçš„è¯å¯ä»¥çœ‹åˆ° values å°±æ˜¯æˆ‘ä»¬è¦çš„æ•°ç»„, ç„¶åé¡ºæ‰‹å¼€å§‹ <code>for in</code>, values çš„ç±»å‹æ˜¯ <code>UnkeyedDecodingContainer</code>, ä½†ç«Ÿç„¶ä¸éµä» <code>Sequence</code> åè®®â€¦æ²¡åŠæ³•éå†è¿™å¯æ˜¯ä¸ªéš¾é¢˜, è€Œä¸”æŸ¥çœ‹ values çš„å…¶ä»–å±æ€§ <code>isAtEnd = false, count = 31</code> ä¹Ÿè¯æ˜äº† values åº”è¯¥æ˜¯å¯ä»¥éå†çš„</p>
<p>æœ€åå‘ç° <code>UnkeyedDecodingContainer</code> çš„éå†æ–¹æ³•å°±åƒä¸€ä¸ªé˜Ÿåˆ—, æ¯æ¬¡è°ƒç”¨ decode å°±å‡ºä¸€ä¸ª, ç„¶åé€šè¿‡ <code>isAtEnd</code> æ¥ç»ˆæ­¢å¾ªç¯å°±å¯ä»¥äº†</p>
<pre><code class="swift">if let url = URL(string: &quot;https://api.github.com/users/bewils/repos&quot;) {
  let session = URLSession(configuration: .default)
  session.dataTask(with: url, completionHandler: { (data, _, err) in
    guard err == nil else { return }

    guard let data = data else { return }
    do {
      // äºŒé€¼ç¨‹åºå‘˜è§£ææ³•
      let repos = try JSONDecoder().decode(UserRepos.self, from: data)
      print(repos.repoList)
    } catch let err {
      print(err)
    }
  }).resume()
}
</code></pre>
<p>è¿™æ ·å°±é€šè¿‡è‡ªå®šä¹‰å®ç° Decodable æˆåŠŸåœ°è§£æå‡ºäº†è¿”å›çš„æ•°ç»„</p>
<h3 id="æ–‡è‰ºç¨‹åºå‘˜"><a href="#æ–‡è‰ºç¨‹åºå‘˜" class="headerlink" title="æ–‡è‰ºç¨‹åºå‘˜"></a>æ–‡è‰ºç¨‹åºå‘˜</h3><p>æ–‡è‰ºç¨‹åºå‘˜çš„è§£ææ–¹æ³•å‘¢?</p>
<pre><code class="swift">let repos = try JSONDecoder().decode([Repo].self, from: data)
</code></pre>
<h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>Swift4 ä¸­æä¾›çš„ Codable ä½¿å¾—è§£æ JSON å˜çš„æå…¶æ–¹ä¾¿, è¿™ç¯‡æ–‡ç« ä¸­ä¸»è¦è®¨è®ºäº† Decodable, å…³äº Encodable åŸºæœ¬ä¸Šå°±æ˜¯ Decodable çš„åå‘æ“ä½œ, å°±ä¸åœ¨è¿™é‡Œè®¨è®ºäº†</p>
<p>æœ¬æ–‡çš„ demo ä»£ç æ”¾åœ¨å¦‚ä¸‹åœ°å€ <a href="https://github.com/bewils/SwiftCodable" target="_blank" rel="external">SwiftCodable</a></p>
<h2 id="å¦"><a href="#å¦" class="headerlink" title="å¦"></a>å¦</h2><p>æ´»åŠ¨é©¬ä¸Šå°±è¦è¿‡å»äº†, è¿˜æ˜¯æ²¡æœ‰æŠ½åˆ°å¸ˆåŒ , æ°” ï¼ˆï½€ã¸Â´ï¼‰</p>
<blockquote>
<p>P ç«™</p>
<p>Lpip(6996493) -ã€Œã‚¹ã‚«ã‚µãƒã€(59639555)</p>
</blockquote>
<p><img src="/images/Swift4Codable/IMG_3923.png" alt="ã‚¹ã‚«ã‚µãƒ"></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Swift/">Swift</a>
    </span>
    

    </div>

    
  </div>
</article>
<div id="container"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
var gitment = new Gitment({
  owner: 'bewils',
  repo: 'å­˜å‚¨è¯„è®ºçš„ repo',
  oauth: {
    client_id: '7238409484b54ebdd4a6',
    client_secret: '4fad27888c7ad67c5a12390a02e4705fb566ded5',
  },
})
gitment.render('container')
</script>





    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2017 Bewils
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>